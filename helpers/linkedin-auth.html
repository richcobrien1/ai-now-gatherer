<!DOCTYPE html>
<html>
<head>
  <title>LinkedIn Auth Helper</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 50px auto; padding: 20px; }
    button { background: #0077b5; color: white; padding: 15px 30px; border: none; cursor: pointer; font-size: 16px; }
    button:hover { background: #005582; }
    pre { background: #f4f4f4; padding: 15px; overflow-x: auto; }
    .step { margin: 30px 0; padding: 20px; border: 2px solid #ddd; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>LinkedIn OAuth Helper</h1>
  
  <div class="step">
    <h2>Step 1: Authorize</h2>
    <p>Click this button to authorize with LinkedIn:</p>
    <button onclick="authorize()">üîê Authorize LinkedIn</button>
  </div>
  
  <div class="step">
    <h2>Step 2: Get Access Token</h2>
    <p>After authorizing, you'll be redirected back with a code in the URL.</p>
    <p>Paste the code here:</p>
    <input type="text" id="authCode" placeholder="Paste authorization code" style="width: 100%; padding: 10px;">
    <br><br>
    <button onclick="getToken()">Get Access Token</button>
  </div>
  
  <div class="step" id="result" style="display: none;">
    <h2>Step 3: Your Credentials</h2>
    <pre id="output"></pre>
    <button onclick="copyToClipboard()">üìã Copy to Clipboard</button>
  </div>

  <script>
    const CLIENT_ID = 'CLIENT_ID';
    const CLIENT_SECRET = 'CLIENT_SECRET';
    const REDIRECT_URI = 'http://localhost:3003/callback';
    
    function authorize() {
      const scope = 'openid profile email w_member_social';
      const state = Math.random().toString(36).substring(7);
      const authUrl = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&state=${state}&scope=${encodeURIComponent(scope)}`;
      
      window.open(authUrl, '_blank');
      alert('After authorizing, copy the "code" parameter from the URL and paste it in Step 2');
    }
    
    async function getToken() {
      const code = document.getElementById('authCode').value.trim();
      if (!code) {
        alert('Please paste the authorization code');
        return;
      }
      
      try {
        const response = await fetch('https://www.linkedin.com/oauth/v2/accessToken', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            grant_type: 'authorization_code',
            code: code,
            client_id: CLIENT_ID,
            client_secret: CLIENT_SECRET,
            redirect_uri: REDIRECT_URI
          })
        });
        
        const data = await response.json();
        
        if (data.access_token) {
          // Now get the user profile to get URN
          const profileResponse = await fetch('https://api.linkedin.com/v2/userinfo', {
            headers: { 'Authorization': `Bearer ${data.access_token}` }
          });
          
          const profile = await profileResponse.json();
          
          const output = `Access Token: ${data.access_token}\n\nLinkedIn URN: urn:li:person:${profile.sub}\n\nRun these commands:\nwrangler secret put LINKEDIN_ACCESS_TOKEN --config wrangler-social.toml\nwrangler secret put LINKEDIN_AUTHOR_URN --config wrangler-social.toml`;
          
          document.getElementById('output').textContent = output;
          document.getElementById('result').style.display = 'block';
        } else {
          alert('Error: ' + JSON.stringify(data));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }
    
    function copyToClipboard() {
      const text = document.getElementById('output').textContent;
      navigator.clipboard.writeText(text);
      alert('Copied to clipboard!');
    }
  </script>
</body>
</html>